const cron = require("node-cron");const { db } = require("../../config/firebaseAdmin");const { order: orderConfig, general } = require("../../config/cleanup.config");const cleanupPendingOrders = async () => {  if (!orderConfig.ENABLED) {    return { deleted: 0, skipped: true };  }  const cutoffTime = Date.now() - orderConfig.PENDING_ORDER_TTL;  try {    const ref = db.ref("pendingOrders");    const snapshot = await ref      .orderByChild("createdAt")      .endAt(cutoffTime)      .once("value");    if (!snapshot.exists()) {      return { deleted: 0 };    }    const updates = {};    let count = 0;    const deletedOrders = [];    snapshot.forEach((child) => {      updates[child.key] = null;      const order = child.val();      deletedOrders.push({        id: child.key,        createdAt: order.createdAt,        tableNumber: order.tableNumber || "N/A",      });      count++;    });    await ref.update(updates);    if (general.VERBOSE_LOGGING) {      console.log(`[Order Cleanup] Deleted ${count} old pending orders`);      console.log(        "  Details:",        deletedOrders          .map(            (o) =>              `Order ${o.id} (Table ${o.tableNumber}) created ${new Date(                o.createdAt              ).toLocaleString(general.TIMEZONE)}`          )          .join("\n           ")      );    } else {      console.log(`[Order Cleanup] Deleted ${count} old pending orders`);    }    return { deleted: count, orders: deletedOrders };  } catch (error) {    console.error("[Order Cleanup] Error:", error);    return { deleted: 0, error: error.message };  }};const startOrderCleanupJob = () => {  if (!orderConfig.ENABLED) {    console.log("[Order Cleanup] Cleanup job is DISABLED in config");    return;  }  const ttlMinutes = Math.floor(orderConfig.PENDING_ORDER_TTL / 1000 / 60);  console.log("╔════════════════════════════════════════════════════════════╗");  console.log("║     ORDER CLEANUP SCHEDULER STARTED                       ║");  console.log("╠════════════════════════════════════════════════════════════╣");  console.log(    `║  Schedule:              ${orderConfig.CRON_SCHEDULE.padEnd(33)}║`  );  console.log(    `║  Pending Order TTL:     ${ttlMinutes} minutes${" ".repeat(      28 - ttlMinutes.toString().length    )}║`  );  console.log(    `║  Verbose Logging:       ${general.VERBOSE_LOGGING ? "ENABLED" : "DISABLED"    }${" ".repeat(29 - (general.VERBOSE_LOGGING ? 7 : 8))}║`  );  console.log("╚════════════════════════════════════════════════════════════╝");  cleanupPendingOrders();  cron.schedule(orderConfig.CRON_SCHEDULE, () => {    cleanupPendingOrders();  });};module.exports = {  startOrderCleanupJob,  cleanupPendingOrders,};