import { useState, useEffect } from 'react';import { getAllInvitations } from '@/api/staff';import { useToast } from '@/hooks/useToast';import { HiMail, HiCheck, HiX, HiClock, HiRefresh } from 'react-icons/hi';import Button from '@/components/ui/Button';import Table from '@/components/ui/Table';import LoadingSpinner from '@/components/ui/LoadingSpinner';export default function InvitationHistoryCard({ restaurantId, onResend, onCancel, refreshTrigger = 0 }) {    const { error } = useToast();    const [invitations, setInvitations] = useState([]);    const [loading, setLoading] = useState(true);    const [page, setPage] = useState(1);    const [limit] = useState(10);    const [total, setTotal] = useState(0);    const [statusFilter, setStatusFilter] = useState('all');    const fetchInvitations = async () => {        try {            setLoading(true);            const result = await getAllInvitations(restaurantId, {                page,                limit,                status: statusFilter,                sortBy: 'createdAt',                sortDir: 'desc'            });            setInvitations(result.data || []);            setTotal(result.meta?.total || 0);        } catch (err) {            console.error('Error fetching invitations:', err);            error('Failed to load invitation history');        } finally {            setLoading(false);        }    };    useEffect(() => {        if (restaurantId) {            fetchInvitations();        }    }, [restaurantId, page, statusFilter, refreshTrigger]);    const getStatusBadge = (status) => {        const badges = {            pending: {                icon: HiClock,                text: 'Pending',                bgClass: 'bg-amber-100',                textClass: 'text-amber-800',                iconClass: 'text-amber-600'            },            accepted: {                icon: HiCheck,                text: 'Accepted',                bgClass: 'bg-green-100',                textClass: 'text-green-800',                iconClass: 'text-green-600'            },            expired: {                icon: HiX,                text: 'Expired',                bgClass: 'bg-red-100',                textClass: 'text-red-800',                iconClass: 'text-red-600'            },            cancelled: {                icon: HiX,                text: 'Cancelled',                bgClass: 'bg-gray-100',                textClass: 'text-gray-800',                iconClass: 'text-gray-600'            }        };        const badge = badges[status] || badges.pending;        const Icon = badge.icon;        return (            <span className={`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium ${badge.bgClass} ${badge.textClass}`}>                <Icon className={`w-3.5 h-3.5 ${badge.iconClass}`} />                {badge.text}            </span>        );    };    const getStatusStats = () => {        const all = invitations.length > 0 ? total : 0;        return { all };    };    const stats = getStatusStats();    if (loading && invitations.length === 0) {        return (            <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-8">                <div className="flex justify-center">                    <LoadingSpinner size="large" />                </div>            </div>        );    }    return (        <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">            <div className="bg-gradient-to-r from-gray-50 to-gray-100 px-6 py-4 border-b border-gray-200">                <div className="flex items-center justify-between">                    <div className="flex items-center gap-3">                        <div className="w-10 h-10 rounded-lg bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center">                            <HiMail className="w-6 h-6 text-white" />                        </div>                        <div>                            <h3 className="font-semibold text-gray-900 text-lg">Invitation History</h3>                            <p className="text-sm text-gray-600">Track all sent invitations</p>                        </div>                    </div>                    <Button                        variant="secondary"                        size="small"                        icon={HiRefresh}                        onClick={fetchInvitations}                        disabled={loading}                    >                        Refresh                    </Button>                </div>            </div>            <div className="px-6 py-4 bg-gray-50 border-b border-gray-200">                <div className="flex items-center gap-2">                    <span className="text-sm font-medium text-gray-700">Filter:</span>                    <div className="flex gap-2">                        {[                            { value: 'all', label: 'All', count: stats.all },                            { value: 'pending', label: 'Pending' },                            { value: 'accepted', label: 'Accepted' },                            { value: 'expired', label: 'Expired' },                            { value: 'cancelled', label: 'Cancelled' }                        ].map(({ value, label, count }) => (                            <button                                key={value}                                onClick={() => {                                    setStatusFilter(value);                                    setPage(1);                                }}                                className={`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${statusFilter === value                                    ? 'bg-red-600 text-white'                                    : 'bg-white text-gray-700 hover:bg-gray-100 border border-gray-200'                                    }`}                            >                                {label}                                {count !== undefined && ` (${count})`}                            </button>                        ))}                    </div>                </div>            </div>            {invitations.length === 0 ? (                <div className="text-center py-12">                    <HiMail className="mx-auto h-12 w-12 text-gray-400" />                    <h3 className="mt-2 text-sm font-medium text-gray-900">No invitations found</h3>                    <p className="mt-1 text-sm text-gray-500">                        {statusFilter === 'all'                            ? 'No invitations have been sent yet.'                            : `No ${statusFilter} invitations found.`}                    </p>                </div>            ) : (                <Table                    columns={[                        {                            key: 'email',                            title: 'Email',                            render: (inv) => (                                <div>                                    <div className="font-medium text-gray-900">{inv.email}</div>                                    <div className="text-xs text-gray-500">                                        Invited: {new Date(inv.createdAt).toLocaleDateString('vi-VN', {                                            day: '2-digit',                                            month: 'short',                                            year: 'numeric',                                            hour: '2-digit',                                            minute: '2-digit'                                        })}                                    </div>                                </div>                            )                        },                        {                            key: 'role',                            title: 'Role',                            render: (inv) => (                                <span className="text-sm font-medium text-gray-700">                                    {inv.roleName || inv.roleId}                                </span>                            )                        },                        {                            key: 'status',                            title: 'Status',                            render: (inv) => getStatusBadge(inv.status)                        },                        {                            key: 'action',                            title: 'Action Date',                            render: (inv) => {                                if (inv.acceptedAt) {                                    return (                                        <div className="text-sm">                                            <div className="text-green-600 font-medium">Accepted</div>                                            <div className="text-xs text-gray-500">                                                {new Date(inv.acceptedAt).toLocaleDateString('vi-VN', {                                                    day: '2-digit',                                                    month: 'short',                                                    hour: '2-digit',                                                    minute: '2-digit'                                                })}                                            </div>                                        </div>                                    );                                }                                if (inv.expiredAt) {                                    return (                                        <div className="text-sm">                                            <div className="text-red-600 font-medium">Expired</div>                                            <div className="text-xs text-gray-500">                                                {new Date(inv.expiredAt).toLocaleDateString('vi-VN', {                                                    day: '2-digit',                                                    month: 'short',                                                    hour: '2-digit',                                                    minute: '2-digit'                                                })}                                            </div>                                        </div>                                    );                                }                                if (inv.cancelledAt) {                                    return (                                        <div className="text-sm">                                            <div className="text-gray-600 font-medium">Cancelled</div>                                            <div className="text-xs text-gray-500">                                                {new Date(inv.cancelledAt).toLocaleDateString('vi-VN', {                                                    day: '2-digit',                                                    month: 'short',                                                    hour: '2-digit',                                                    minute: '2-digit'                                                })}                                            </div>                                        </div>                                    );                                }                                if (inv.expiresAt) {                                    const remaining = inv.expiresAt - Date.now();                                    const minutes = Math.floor(remaining / 1000 / 60);                                    return (                                        <div className="text-sm">                                            <div className="text-amber-600 font-medium">                                                {minutes > 0 ? `${minutes}m remaining` : 'Expiring soon'}                                            </div>                                            <div className="text-xs text-gray-500">                                                Expires: {new Date(inv.expiresAt).toLocaleDateString('vi-VN', {                                                    day: '2-digit',                                                    month: 'short',                                                    hour: '2-digit',                                                    minute: '2-digit'                                                })}                                            </div>                                        </div>                                    );                                }                                return <span className="text-sm text-gray-400">-</span>;                            }                        },                        {                            key: 'actions',                            title: 'Actions',                            render: (inv) => {                                if (inv.status === 'expired' || inv.status === 'cancelled') {                                    return (                                        <Button                                            variant="secondary"                                            size="small"                                            icon={HiRefresh}                                            onClick={() => onResend && onResend(inv)}                                        >                                            Resend                                        </Button>                                    );                                }                                if (inv.status === 'pending') {                                    return (                                        <Button                                            variant="danger"                                            size="small"                                            icon={HiX}                                            onClick={() => onCancel && onCancel(inv)}                                        >                                            Cancel                                        </Button>                                    );                                }                                return <span className="text-sm text-gray-400">-</span>;                            }                        }                    ]}                    data={invitations}                    loading={loading}                    rowKey="id"                    pagination={{ page, limit, total }}                    onPageChange={setPage}                />            )}        </div>    );}